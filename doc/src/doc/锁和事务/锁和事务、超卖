事务和锁的区别：事务是保证一致性，隔离性（锁），持久性，原子性（日志）    锁是事务的隔离性的解决办法
redis：
1，事务：get和incr，需要事务保证两个操作原子性
2，锁：get和incr中间可能被抢光了，库存需要保证锁定，1：watch类似乐观锁，2：redisson

mysql：
1，事务：需要事务保证两个操作原子性
2，锁：mysql乐观锁、悲观锁 、java锁

解决超卖本质还是需要锁。乐观锁：查不到；悲观锁：阻塞，然后查不到


用sychronized  是因为， 数据出了数据库事务范围外

超卖之所以要用乐观悲观锁，是因为 不同线程 进入相同事务里select，（应为mvcc，快照机制）获取到的库存都可能是最后一个

解决1：悲观锁，select for update  ，把select 也变成当前读，当前线程的事务结束之前，那么别的线程就不能操作了
解决2：乐观锁， （版本号）把检查放到update语句中



